<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Vibe Writer</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>

<%- include('partials/dashboard-header') %>

<main class="dashboard-container">
  <h1 class="dashboard-title">Settings</h1>

  <div class="prompt-card">
    <div class="card-header">
      <h2>Prompt Configuration</h2>
    </div>
    <div class="card-body">
      <p>
        Use the text area below to provide instructions for the AI. Describe the tone, style, or specific elements you want it to focus on. There's no need to include activity data placeholders; that will be handled automatically.
      </p>
      <form action="/settings/prompt" method="POST" class="prompt-form">
        <div class="form-group">
          <label for="prompt" class="prompt-label">Your Instructions</label>
          <textarea id="prompt" name="prompt" rows="8" class="prompt-textarea"><%= locals.user && user.prompt ? user.prompt : 'Make my titles sound epic and heroic.' %></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Save Prompt</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Unit Preference Section -->
  <div class="prompt-card">
    <div class="card-header">
      <h2>Unit Preference</h2>
    </div>
    <div class="card-body">
      <p>
        Choose whether you want your activity data displayed in imperial (miles, feet) or metric (kilometers, meters) units. This affects the data sent to the AI for title generation.
      </p>
      <form action="/settings/preferences" method="POST" id="preferences-form" class="prompt-form">
        <div class="form-group">
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="is_imperial" value="true" <%= locals.user && user.is_imperial !== false ? 'checked' : '' %>>
              <span>Imperial (miles, feet)</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="is_imperial" value="false" <%= locals.user && user.is_imperial === false ? 'checked' : '' %>>
              <span>Metric (kilometers, meters)</span>
            </label>
          </div>
        </div>

        <!-- Activity Types Section -->
        <div class="form-group" style="margin-top: 2rem;">
          <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Activity Types for Title Generation</h3>
          <p style="color: var(--text-light-color); margin-bottom: 1rem;">
            Select which types of activities should receive AI-generated titles. Other activity types will keep their default names.
          </p>
          
          <!-- Select All / Deselect All buttons -->
          <div class="activity-type-controls">
            <button type="button" id="select-all-btn" class="btn btn-secondary btn-sm">Select All</button>
            <button type="button" id="deselect-all-btn" class="btn btn-secondary btn-sm">Deselect All</button>
          </div>

          <!-- Common activity types (always visible) -->
          <div class="activity-types-grid">
            <% 
            const userActivityTypes = locals.userActivityTypes || [];
            activityTypes.common.forEach(type => { 
            %>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  name="activity_types" 
                  value="<%= type %>" 
                  <%= userActivityTypes.includes(type) ? 'checked' : '' %>
                >
                <span><%= type %></span>
              </label>
            <% }); %>
          </div>

          <!-- Expandable section for additional activity types -->
          <div id="expanded-types-container" style="display: none;">
            <div class="activity-types-grid" style="margin-top: 1rem;">
              <% activityTypes.expanded.forEach(type => { %>
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    name="activity_types" 
                    value="<%= type %>" 
                    <%= userActivityTypes.includes(type) ? 'checked' : '' %>
                  >
                  <span><%= type %></span>
                </label>
              <% }); %>
            </div>
          </div>

          <!-- Show More button -->
          <button type="button" id="show-more-btn" class="btn btn-secondary" style="margin-top: 1rem; width: 100%;">
            <span id="show-more-text">Show More Activity Types</span>
            <span id="show-more-icon">â–¼</span>
          </button>
        </div>

        <div class="form-actions" style="margin-top: 2rem;">
          <button type="submit" class="btn btn-primary">Save Preferences</button>
        </div>
      </form>
    </div>
  </div>

  <div class="prompt-card">
    <div class="card-header">
      <h2>Full Prompt Preview</h2>
    </div>
    <div class="card-body">
      <p>
        This is a read-only preview of the full prompt that will be sent to the AI, combining the system instructions with your custom instructions.
      </p>
      <div class="prompt-preview">
        <pre><code><%= locals.fullPromptPreview %></code></pre>
      </div>
    </div>
  </div>

</main>

<%- include('partials/footer') %>

<script src="/js/settings.js"></script>
</body>
</html> 