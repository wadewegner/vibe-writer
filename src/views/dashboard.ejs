<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibe Writer: Stop Writing Boring Strava Titles</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>

<%- include('partials/dashboard-header') %>

<main class="dashboard-container">
  <h1 class="dashboard-title">Dashboard</h1>

  <h2 class="activities-title">Generated Titles</h2>
  
  <!-- Activity Cards (Mobile) -->
  <div class="activities-cards-container">
    <% if (locals.activities && activities.length > 0) { %>
      <% activities.forEach(activity => { %>
        <div class="activity-card" data-activity-id="<%= activity.id %>" data-expanded="false">
          <div class="activity-card-header">
            <div class="activity-card-date">
              <%= new Date(activity.processed_at).toLocaleDateString() %>
            </div>
            <div class="activity-card-title-row">
              <div class="activity-card-title" id="activity-card-title-<%= activity.id %>">
                <%= activity.generated_title %>
              </div>
              <button class="activity-card-regenerate btn regenerate-btn" data-activity-id="<%= activity.id %>" title="Regenerate Title" aria-label="Regenerate Title">
                &#x21bb;
              </button>
            </div>
          </div>
          <div class="activity-card-body">
            <div class="activity-card-body-content">
              <div class="activity-card-detail">
                <div class="activity-card-detail-label">Original Title</div>
                <div class="activity-card-detail-value"><%= activity.original_title %></div>
              </div>
              <div class="activity-card-detail">
                <div class="activity-card-detail-label">Activity</div>
                <div class="activity-card-detail-value">
                  <a href="https://www.strava.com/activities/<%= activity.activity_id %>" target="_blank">View on Strava</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="activity-cards-empty">
        No activities processed yet. New activities will appear here automatically.
      </div>
    <% } %>
  </div>
  
  <!-- Activity Table (Desktop) -->
  <div class="activities-table-container">
    <table class="activities-table">
      <thead>
        <tr>
          <th style="width: 5%;"></th>
          <th>Date</th>
          <th>Original Title</th>
          <th>Generated Title</th>
          <th>Activity</th>
        </tr>
      </thead>
      <tbody>
        <% if (locals.activities && activities.length > 0) { %>
          <% activities.forEach(activity => { %>
            <tr>
              <td>
                <button class="btn regenerate-btn" data-activity-id="<%= activity.id %>" title="Regenerate Title">
                  &#x21bb; <!-- Unicode for clockwise open circle arrow -->
                </button>
              </td>
              <td><%= new Date(activity.processed_at).toLocaleDateString() %></td>
              <td><%= activity.original_title %></td>
              <td><span id="activity-title-<%= activity.id %>"><%= activity.generated_title %></span></td>
              <td><a href="https://www.strava.com/activities/<%= activity.activity_id %>" target="_blank">View on Strava</a></td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="5" class="table-empty-message">No activities processed yet. New activities will appear here automatically.</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</main>

<!-- Regeneration Confirmation Modal -->
<div class="modal-overlay" id="regenerate-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Confirm New Title</h5>
      <button type="button" class="modal-close-btn" data-bs-dismiss="modal">&times;</button>
    </div>
    <div class="modal-body">
      <p>A new title has been generated for your activity.</p>
      <p><strong>Original Title:</strong> <span id="original-title-placeholder"></span></p>
      <p><strong>New Title:</strong> <span id="new-title-placeholder"></span></p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn" id="cancel-regenerate">Cancel</button>
      <button type="button" class="btn btn-secondary" id="regenerate-again">Regenerate Again</button>
      <button type="button" class="btn btn-primary" id="accept-regenerate">Accept New Title</button>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
<script src="/js/navigation.js"></script>
<script src="/js/dashboard.js"></script> 
</body>
</html> 