# Product Requirements Document: Strava Title Generator

## 1. Introduction/Overview

This document outlines the requirements for the "Strava Title Generator," a web application designed for Strava athletes. The app will automate the process of creating engaging and personalized titles for their Strava activities. Users will connect their Strava account, provide a natural language prompt, and a backend service will use this prompt to generate and update titles for new activities via an AI service. The goal is to create a seamless, "set it and forget it" experience for the user, enhancing their Strava posts with minimal effort.

## 2. Goals

*   **Save Time:** Automate the manual task of editing Strava activity titles.
*   **Enhance Creativity:** Generate unique, creative, and engaging titles that go beyond default names like "Morning Run."
*   **Provide Insight:** Automatically incorporate key workout statistics into titles in a user-defined way.
*   **Deliver a Premium Experience:** Offer a slick, modern, and intuitive user interface and a reliable backend service.

## 3. User Stories

*   **As a new user,** I want to sign up for the service by securely authenticating with my Strava account so that the app can access my profile and activities.
*   **As a user,** I want to define how my titles are generated by writing a simple, natural language prompt (e.g., "Make a witty title for my ride, mention the city, and include the distance").
*   **As a user,** I want my new Strava activities to have their titles automatically updated by the service shortly after they are uploaded, without any manual intervention.
*   **As a user,** I want to see a history of my activities and the titles generated for them within the app's dashboard.
*   **As a user,** I want assurance that the app will update each activity title only once to avoid errors or duplicate updates.
*   **As an operator,** I want clear instructions on how to set up, deploy, and manage the application on DigitalOcean's App Platform.

## 4. Functional Requirements

1.  **User Authentication:** The system must use the Strava OAuth 2.0 flow for user sign-up and login.
2.  **Prompt Configuration:** Users must have a dedicated page where they can create and update their title generation prompt.
3.  **Webhook Integration:** The backend must be able to receive and process new activity events from Strava using Webhooks.
4.  **AI Title Generation:** The system will call an OpenAI-compatible inferencing service, sending the user's prompt and relevant activity data to generate a title.
5.  **Activity Data for AI:** For generating titles, the system will pass the following fields from the Strava activity to the AI service: `type`, `distance`, `moving_time`, `elapsed_time`, `total_elevation_gain`, and `start_latlng`.
6.  **Activity Processing:** The backend worker must parse incoming webhook payloads to extract activity details.
7.  **Idempotency:** The system must store the ID of every processed Strava activity in a PostgreSQL database to prevent re-processing the same activity.
8.  **Strava API Integration:** The system must use the Strava API to update the title of the new activity.
9.  **User Dashboard:** The frontend will feature a comprehensive dashboard displaying:
    *   User's connection status.
    *   The current prompt configuration.
    *   A history of recent activities with original and generated titles.
    *   Analytics on titles generated.
10. **Error Handling:** In case of failures (e.g., Strava API is down, AI service fails), the system will log the error details to the database for debugging and display a simple, friendly error message to the user in the dashboard if appropriate. A background job retry mechanism is out of scope for the initial version.
11. **Environment Management:** The application must use `.env` files for managing all secrets and environment-specific configurations (API keys, database URLs, etc.).

## 5. Non-Goals (Out of Scope)

*   The application will not edit titles for activities that existed before the user signed up.
*   The application will not provide a feature to manually trigger updates for specific activities.
*   No social features like sharing, following, or commenting will be included.
*   The application will only support Strava and no other fitness platforms.
*   **Deployment:**
    *   **Platform:** DigitalOcean App Platform.
    *   **Architecture:** The app will be split into two components: a **Web Service** for the frontend and a **Worker** for the background processing task.
    *   **CI/CD:** Deployment will be handled by DigitalOcean's App Platform. Pushing changes to the `main` branch in the GitHub repository will automatically trigger a new deployment.
*   **Version Control:** The project will be initialized as a Git repository with a comprehensive `.gitignore` file.
*   **Strava Webhook Subscription:** The initial setup requires a one-time webhook subscription process:
    1.  The application sends a `POST` request to the Strava API (`/push_subscriptions`) with our `client_id`, `client_secret`, a `callback_url` (our worker's endpoint), and a `verify_token`.
    2.  Strava immediately sends a `GET` request to our `callback_url` with a `hub.challenge` query parameter.
    3.  Our worker must respond with a `200 OK` status and a JSON body echoing back the `hub.challenge` value (e.g., `{"hub.challenge":"value_from_strava"}`).
    4.  Once confirmed, the subscription is active, and Strava will send `POST` events for new activities to our `callback_url`.
*   **API Rate Limiting:**
    *   **Strava API:** The application must respect Strava's rate limits of 600 requests per 15 minutes and 30,000 requests per day. The application's usage should be monitored.
    *   **AI Service:** The chosen AI inferencing service will have its own rate limits, which must be identified and managed.

## 6. Design and Technical Considerations

*   **Frontend:**
    *   **Framework:** Node.js with Express and EJS for server-side rendering.
    *   **Styling:** Bootstrap will be used to create a modern, responsive, and "slick" user interface. It will be included via CDN.
*   **Backend:**
    *   **Framework:** A Node.js worker process.
    *   **Database:** DigitalOcean Managed PostgreSQL.
*   **Deployment:**
    *   **Platform:** DigitalOcean App Platform.
    *   **Architecture:** The app will be split into two components: a **Web Service** for the frontend and a **Worker** for the background processing task.
    *   **CI/CD:** Deployment will be automated through GitHub Actions.
*   **Version Control:** The project will be initialized as a Git repository with a comprehensive `.gitignore` file.

## 7. Success Metrics

*   **User Adoption:** Number of active monthly users.
*   **Engagement:** Total number of titles successfully generated per week.
*   **Reliability:** Uptime of the web service and worker.
*   **User Retention:** Percentage of users who remain active 30 days after sign-up.

## 8. Open Questions

*All initial questions have been resolved and their answers incorporated into this document.* 